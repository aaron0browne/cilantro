{% load url from future %}
<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang=en> <![endif]-->
<!--[if IE 7]> <html class="lt-ie9 lt-ie8" lang=en> <![endif]-->
<!--[if IE 8]> <html class="lt-ie9" lang=en> <![endif]-->
<!--[if gt IE 8]><!--> <html lang=en> <!--<![endif]-->
<head>
    <meta charset=utf-8>

    <!-- Use the .htaccess and remove these lines to avoid edge case issues.
             More info: h5bp.com/i/378 -->
    <meta http-equiv=X-UA-Compatible content=IE=edge,chrome=1>

    <title>{% block head_title %}{{ cilantro.config.title }}{% endblock %}</title>
    <meta name=description content="{{ cilantro.config.subtitle }}">

    <!-- Mobile viewport optimized: h5bp.com/viewport -->
    <meta name=viewport content=width=device-width>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

    {% block styles %}
        <link rel=stylesheet href={{ cilantro.css_url }}/style.css>
    {% endblock %}

    <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->
</head>
<body>
    <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
             chromium.org/developers/how-tos/chrome-frame-getting-started -->
    <!--[if lt IE 9]><p class=chromeframe>Your browser is <em>ancient!</em> <a href=http://browsehappy.com/>Upgrade to a different browser</a> or <a href=http://www.google.com/chromeframe/?redirect=true>install Google Chrome Frame</a> to experience this site.</p><![endif]-->

    <!-- Add your site or application content here -->
    {% block header %}
        <div class="navbar navbar-fixed-top navbar-inverse">
            <div class=navbar-inner>
                <div class=container-fluid>
                    {% block header_content %}

                        {% include "cilantro/_brand.html" %}

                        {% if cilantro.config.subtitle %}
                            <span class=subtitle>{{ cilantro.config.subtitle }}</span>
                        {% endif %}

                        {% block header_nav %}
                            <ul class="nav pull-right">
                                {% if user.is_authenticated %}
                                    {% include "cilantro/_auth-header-nav.html" %}
                                {% elif cilantro.config.auth_required %}
                                    {% include "cilantro/_header-nav.html" %}
                                {% endif %}
                            </ul>
                        {% endblock %}

                    {% endblock %}
                </div>
            </div>
        </div> {% endblock %}

    {% block subnav %}
        <div id=subnav class="navbar navbar-fixed-top">
            <div class=navbar-inner>
                <div class=container-fluid>{% block subnav_content %}{% endblock %}</div>
            </div>
        </div>
    {% endblock %}

    <div class=container-fluid>
        {% block content %}
        {% endblock content %}
    </div>

    {% block extra_content %}{% endblock %}


    <!-- JavaScript at the bottom for fast page loading: http://developer.yahoo.com/performance/rules.html#js_bottom -->

    {% block jsconfig %}
        <script>
            var App = {
                // Used by the pushState history to correctly define the
                // root URL
                SCRIPT_NAME: '{{ request.META.SCRIPT_NAME }}',

                // Used for non-safe requests, also defined in `environ.js`
                CSRF_TOKEN: '{{ csrf_token }}',

                urls: {
                    dataviews: '{% url "serrano:dataviews" %}',
                    datacontexts: '{% url "serrano:datacontexts" %}',
                    dataconcepts: '{% url "serrano:dataconcepts" %}',
                    datafields: '{% url "serrano:datafields" %}',

                    preferences: '{% url "cilantro:preferences" %}',
                    workspace: '{% url "cilantro:workspace" %}',
                    discover: '{% url "cilantro:discover" %}',
                    analyze: '{% url "cilantro:analyze" %}',
                    review: '{% url "cilantro:review" %}'
                }
            },


            // Pre-configuration, everything is relative to Cilantro's path. For
            // integration of external scripts, create a contexted `require`
            // function. See http://requirejs.org/docs/api.html#multiversion.
            // Note that all existing scripts defined here can be used
            require = {
                baseUrl: '{{ cilantro.javascript_url }}',
                shim: {
                    'underscore': {
                        exports: '_'
                    },
                    'backbone': {
                        deps: ['underscore', 'jquery'],
                        exports: 'Backbone'
                    },
                    'highcharts': {
                        exports: 'Highcharts'
                    },
                    'plugins/bootstrap': ['jquery'],
                    'plugins/bootstrap-typeahead': ['jquery'],
                    'plugins/jquery-ui': ['jquery']
                }
            };
        </script>
    {% endblock jsconfig %}


    {% block scripts %}
        <script data-main=environ src={{ cilantro.javascript_url }}/require.js></script>
    {% endblock scripts %}

    <!-- Asynchronous Google Analytics snippet. Change UA-XXXXX-X to be your site's ID.
             mathiasbynens.be/notes/async-analytics-snippet -->
    {% if cilantro.config.google_analytics %}
    <script>
        var _gaq=[['_setAccount','{{ cilantro.config.google_analytics }}'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    {% endif %}
</body>
</html>
