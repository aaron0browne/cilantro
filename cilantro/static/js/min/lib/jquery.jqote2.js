(function(a){function d(b,c){throw a.extend(b,c),b}function c(a){var b=[];if(n.call(a)!==h)return!1;for(var c=0,d=a.length;c<d;c++)b[c]=a[c].jqote_id;return b.length?b.sort().join(".").replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):!1}function b(c,d){var e,f=[],d=d||l,g=n.call(c);if(g===j)return c.jqote_id?[c]:!1;if(g!==h)return[a.jqotec(c,d)];if(g===h)for(var i=0,k=c.length;i<k;i++)(e=b(c[i],d))&&f.push(e[0]);return f.length?f:!1}var e="UndefinedTemplateError",f="TemplateCompilationError",g="TemplateExecutionError",h="[object Array]",i="[object String]",j="[object Function]",k=1,l="%",m=/^[^<]*(<[\w\W]+>)[^>]*$/,n=Object.prototype.toString;a.fn.extend({jqote:function(b,c){var b=n.call(b)===h?b:[b],d="";this.each(function(e){var f=a.jqotec(this,c);for(var g=0;g<b.length;g++)d+=f.call(b[g],e,g,b,f)});return d}}),a.each({app:"append",pre:"prepend",sub:"html"},function(d,e){a.fn["jqote"+d]=function(f,g,h){var i,j,k=a.jqote(f,g,h),l=m.test(k)?a:function(b){return a(document.createTextNode(b))};!(i=c(b(f)))||(j=new RegExp("(^|\\.)"+i.split(".").join("\\.(.*)?")+"(\\.|$)"));return this.each(function(){var b=l(k);a(this)[e](b),(b[0].nodeType===3?a(this):b).trigger("jqote."+d,[b,j])})}}),a.extend({jqote:function(a,c,f){var g="",f=f||l,i=b(a);i===!1&&d(new Error("Empty or undefined template passed to $.jqote"),{type:e}),c=n.call(c)!==h?[c]:c;for(var j=0,k=i.length;j<k;j++)for(var m=0;m<c.length;m++)g+=i[j].call(c[m],j,m,c,i[j]);return g},jqotec:function(b,c){var h,j,o,c=c||l,p=n.call(b);if(p===i&&m.test(b)){j=o=b;if(h=a.jqotecache[b])return h}else{j=p===i||b.nodeType?a(b):b instanceof jQuery?b:null,(!j[0]||!(o=j[0].innerHTML)&&!(o=j.text()))&&d(new Error("Empty or undefined template passed to $.jqotec"),{type:e});if(h=a.jqotecache[a.data(j[0],"jqote_id")])return h}var q="",r,s=o.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+c).join(c+">").split(c+">");for(var t=0,u=s.length;t<u;t++)q+=s[t].charAt(0)!==""?"out+='"+s[t].replace(/(\\|["'])/g,"\\$1")+"'":s[t].charAt(1)==="="?";out+=("+s[t].substr(2)+");":s[t].charAt(1)==="!"?";out+=$.jqotenc(("+s[t].substr(2)+"));":";"+s[t].substr(1);q="try{"+('var out="";'+q+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+g+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var v=new Function("i, j, data, fn",q)}catch(w){d(w,{type:f})}r=j instanceof jQuery?a.data(j[0],"jqote_id",k):j;return a.jqotecache[r]=(v.jqote_id=k++,v)},jqotefn:function(b){var c=n.call(b),d=c===i&&m.test(b)?b:a.data(a(b)[0],"jqote_id");return a.jqotecache[d]||!1},jqotetag:function(a){n.call(a)===i&&(l=a)},jqotenc:function(a){return a.toString().replace(/&(?!\w+;)/g,"&#38;").split("<").join("&#60;").split(">").join("&#62;").split('"').join("&#34;").split("'").join("&#39;")},jqotecache:{}}),a.event.special.jqote={add:function(a){var d,e=a.handler,f=a.data?n.call(a.data)!==h?[a.data]:a.data:[];a.namespace||(a.namespace="app.pre.sub"),f.length&&(d=c(b(f)))&&(a.handler=function(a,b,c){return!c||c.test(d)?e.apply(this,[a,b]):null})}}})(jQuery)