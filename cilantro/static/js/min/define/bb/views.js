define("define/bb/views",["define/bb/models","lib/backbone","lib/clerk"],function(a){$(function(){var b=Backbone.View.extend({events:{click:"setModelActiveState"},initialize:function(){this.model.bind("change:active",_.bind(this.toggleActiveState,this)),this.model.view=this,this.render()},render:function(){this.jq=this.jq||$(this.el),this.jq.html(this.template(this.model.toJSON())),this.trigger("render");return this},setModelActiveState:function(a){this.model.collection.updateActiveState(this.model.id)},toggleActiveState:function(){this.model.get("active")?this.jq.addClass("active"):this.jq.removeClass("active")}}),c=Backbone.View.extend({initialize:function(){this.collection.bind("refresh",_.bind(this.render,this)),this.collection.fetch()},render:function(){this.collection.each(_.bind(this.createModelView,this)),this.trigger("render");return this},createModelView:function(a){var b=new this.modelView({model:a});this.jq.append(b.el)}}),d=b.extend({tagName:"span",className:"tag",template:_.template('<div class="icon"></div><span><%= name %></span>'),render:function(){this.el.id||(this.el.id="tab-"+this.model.get("name").toLowerCase());return b.prototype.render.call(this)}}),e=c.extend({jq:$("#categories"),modelView:d,initialize:function(){this.bind("render",this.selectFirst),c.prototype.initialize.call(this)},selectFirst:function(){clerk.send(this.collection,function(){this.updateActiveState(this.at(0).id)})}}),f=b.extend({tagName:"div",template:_.template(['<div class="icon info"></div>','<span class="name"><%= name %></span>','<span class="description"><%= description %></span>'].join("")),initialize:function(){this.model.bind("change:visible",_.bind(this.toggleVisibleState,this)),b.prototype.initialize.call(this)},render:function(){b.prototype.render.call(this),this.toggleVisibleState();return this},toggleVisibleState:function(){this.model.get("visible")?this.jq.show():this.jq.hide()}}),g=c.extend({jq:$("#criteria"),modelView:f}),h=Backbone.View.extend({jq:$("#search"),focused:!1,timer:null,events:{focus:"focus",blur:"blur",keyup:"keyup"},initialize:function(){this.render()},render:function(){this.el=this.jq[0],this.delegateEvents()},focus:function(){this.focused=!0,this.trigger("focused")},blur:function(){this.focused=!1,this.trigger("blurred")},keyup:function(){clearTimeout(this.timer);var a=this;this.timer=setTimeout(function(){a.trigger("query",[a.jq.val()])},100)}}),i=Backbone.View.extend({id:"search-results",tagName:"div",empty:$('<p style="font-style:italic">No results found</p>'),collection:a.CriterionCollection,input:new h,events:{mouseenter:"enter",mouseleave:"leave"},query:null,focused:!1,initialize:function(){this.input.bind("focused",_.bind(this.show,this)),this.input.bind("blurred",_.bind(this.hide,this)),this.input.bind("query",_.bind(this.query,this)),this.render()},render:function(){this.jq=$(this.el),this.jq.appendTo("body")},setPosition:function(){var a=this.jq,b=this.input.jq,c=a.outerWidth(),d=b.offset(),e=b.outerHeight(),f=b.outerWidth();a.css({left:d.left-(c-f)/2,top:d.top+e+5})},enter:function(){this.focused=!0},leave:function(){this.focused=!1,this.input.focused||this.hide()},show:function(){this.setPosition(),this.query&&this.jq.show()},hide:function(){this.focused||this.jq.fadeOut("fast")},query:function(a){var b=this;$.getJSON(this.collection.url,{q:a},function(a){})}});i=new i({}),e=new e({collection:a.CategoryCollection}),g=new g({collection:a.CriterionCollection})})})