var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};define(["common/models/state","common/views/state","common/views/collection"],function(a,b,c){var d,e,f,g,h,i,j,k;d=function(){function b(){b.__super__.constructor.apply(this,arguments)}__extends(b,a.Model);return b}(),e=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection),a.prototype.model=d,a.prototype.url=App.urls.domains,a.prototype.initialize=function(){this.bind("active",this.activate),this.bind("inactive",this.inactivate);return App.hub.subscribe("domain/request",__bind(function(a){var b,c;b=this.get(a);if(b)return b.activate();c=this.subdomains.get(a),b=this.get(c.get("parent").id),b.activate();return c.activate()},this))},a.prototype.parse=function(a,b){var c,d,e,f,g;d=_.groupBy(a,function(a){var b;return((b=a.parent)!=null?b.id:void 0)||null}),this.subdomains=new i,new j({collection:this.subdomains}),c=d["null"],delete d["null"],g=_.flatten(_.values(d));for(f in d)e=parseInt(f),g.push({id:e,name:"All",parent:{id:e}});this.subdomains.reset(g);return c},a.prototype.activate=function(a){App.hub.publish("domain/active",a.id);return this.chain().without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){return App.hub.publish("domain/inactive",a.id)};return a}(),g=function(){function a(){this.click=__bind(this.click,this),a.__super__.constructor.apply(this,arguments)}__extends(a,b.View),a.prototype.el='<span role="domain">\n                <div class="icon"></div><span role="name"></span>\n            </span>',a.prototype.elements={span:"name"},a.prototype.events={click:"click"},a.prototype.render=function(){var a;a=this.model.get("name"),this.el.attr({id:"tab-"+a.toLowerCase()}),this.name.text(this.model.get("name"));return this},a.prototype.click=function(a){return this.model.activate()};return a}(),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,c.View),a.prototype.el="#domains",a.prototype.viewClass=g;return a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,d);return a}(),i=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,e),a.prototype.model=h,a.prototype.initialize=function(){App.hub.subscribe("domain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate);return this.bind("inactive",this.inactivate)},a.prototype.comparator=function(a){return a.id},a.prototype.groupByDomain=function(){return this._byDomain=this.groupBy(function(a){return a.get("parent").id})},a.prototype.toggleEnableByDomain=function(a){var b;b=!1,this.map(__bind(function(c){if(c.get("parent").id!==a)return c.disable();c.enable({reactivate:!0});if(c.isActive())return b=!0},this));if(!b&&this._byDomain[a])return this.get(a).activate()},a.prototype.activate=function(a){App.hub.publish("subdomain/active",a.id);return _(this._byDomain[a.get("parent").id]).without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){return App.hub.publish("subdomain/inactive",a.id)};return a}(),k=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,g),a.prototype.el='<span role="name"></span>',a.prototype.render=function(){this.el.text(this.model.get("name"));return this};return a}(),j=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,f),a.prototype.el="#subdomains",a.prototype.viewClass=k,a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);return App.hub.subscribe("domain/active",this.toggleEnableByDomain)},a.prototype.toggleEnableByDomain=function(a){if(!this.collection._byDomain[a]){if(!this.el.is(":hidden"))return this.el.fadeTo(100,0).slideUp("fast")}else if(this.el.is(":hidden"))return this.el.slideDown("fast").fadeTo(100,1)};return a}();return{Model:d,Collection:e,View:g,CollectionView:f}})