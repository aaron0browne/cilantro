var __slice=Array.prototype.slice,__bind=function(a,b){return function(){return a.apply(b,arguments)}};define("common/utils",[],function(){var a,b,c,d;b=function(a,b){var c,d,e;e=[];for(d in b)c=b[d],e.push(a[d]=c);return e},c=function(a,c){return b(a.prototype,c)},d=function(a,b,c){var d,e,f,g,h,i;arguments.length<3&&(h=[typeof exports!="undefined"?exports:window].concat(__slice.call(arguments)),a=h[0],b=h[1],c=h[2]),e=a,i=b.split(".");for(f=0,g=i.length;f<g;f++)d=i[f],a=a[d]||(a[d]={});return c(a,e)},a=function(){function a(a){a.pending||(a.pending=0),b(this,a)}a.prototype._ready=function(){var a;if(!this._queue){this._queue=[];return a=setInterval(__bind(function(){var b,c,d,e;if(this.pending===0){this._isReady=!0,clearTimeout(a),e=this._queue;for(c=0,d=e.length;c<d;c++)b=e[c],b();return delete this._queue}},this),25)}},a.prototype.ready=function(a){this._ready();if(this._isReady)return a();return this._queue.push(a)};return a}();return{extend:b,include:c,namespace:d,App:a}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};define("common/models/polling",["common/utils"],function(a){var b,c,d;b={pollInterval:3e4,initialize:function(){return this.startPolling()},startPolling:function(){return this._pollInterval=setInterval(__bind(function(){return this.poll()},this),this.pollInterval)},stopPolling:function(){return clearTimeout(this._pollInterval)},poll:function(){return this.fetch()}},d=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Model);return a}(),c=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection);return a}(),a.include(d,b),a.include(c,b);return{Model:d,Collection:c}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};define("cilantro/modules/report",["common/models/polling"],function(a){var b,c,d;b=function(){function b(){b.__super__.constructor.apply(this,arguments)}__extends(b,a.Model),b.prototype.url=App.urls.session.report,b.prototype.defaults={name:"click to add a name...",description:"click to add a description..."},b.prototype.toJSON=function(){var a,c,d;a=b.__super__.toJSON.apply(this,arguments),a.perspective=((c=a.perspective)!=null?c.id:void 0)||null,a.scope=((d=a.scope)!=null?d.id:void 0)||null;return a},b.prototype.initialize=function(){return this.bind("change",function(){this.unbind("change");return this.bind("change",this.save)})};return b}(),d=function(){function a(){this.enter=__bind(this.enter,this),this.show=__bind(this.show,this),this.edit=__bind(this.edit,this),this.render=__bind(this.render,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.el="#report-name",a.prototype.events={"click span":"edit","blur [name=name]":"show","keypress [name=name]":"enter"},a.prototype.elements={span:"name","[name=name]":"nameInput"},a.prototype.initialize=function(){return this.model.bind("change",this.render)},a.prototype.render=function(){var a;(a=this.model.get("name"))?this.name.removeClass("placeholder"):(this.name.addClass("placeholder"),a=this.model.defaults.name);return this.name.text(a)},a.prototype.edit=function(){this.model.stopPolling(),this.name.hide();return this.nameInput.show().select()},a.prototype.show=function(a){var b;(b=this.nameInput.val())&&!/^\s*$/.test(b)&&(this.model.set({name:b}),this.render()),this.name.show(),this.nameInput.hide();return this.model.startPolling()},a.prototype.enter=function(a){if(a.which===13)return this.show()};return a}(),c=function(){function a(){this.showDescription=__bind(this.showDescription,this),this.editDescription=__bind(this.editDescription,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.el="#report-info",a.prototype.events={"click p":"editDescription","blur [name=description]":"showDescription"},a.prototype.elements={p:"description","[name=description]":"descriptionInput"},a.prototype.initialize=function(){if(this.model.id&&this.model.get("has_changed"))return this.el.addClass("unsaved")},a.prototype.editDescription=function(){this.description.hide();return this.descriptionInput.show().select()},a.prototype.showDescription=function(){this.model.get("description")?this.description.removeClass("placeholder"):(this.model.set({description:this.model.defaults.description}),this.description.addClass("placeholder")),this.description.show();return this.descriptionInput.hide()};return a}();return{Model:b,NameView:d,InfoView:c}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};define("common/models/state",[],function(){var a;a=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Model),a.prototype.defaults={_active:!1,_enabled:!0},a.prototype.initialize=function(){this.bind("change:_active",this._changeActive);return this.bind("change:_enabled",this._changeEnabled)},a.prototype.toJSON=function(){var b;b=a.__super__.toJSON.apply(this,arguments),delete b._active,delete b._enabled;return b},a.prototype._changeActive=function(a,b,c){var d;d=b?"active":"inactive";return this.trigger(d,this,c)},a.prototype._changeEnabled=function(a,b,c){var d;d=b?"enabled":"disabled";return this.trigger(d,this,c)},a.prototype.enable=function(a){var b;a==null&&(a={}),b=!this.get("_enabled"),this.set("_enabled",!0,a);if(a.reactivate&&b&&this.isActive())return this._changeActive(this,!0)},a.prototype.disable=function(a){return this.set("_enabled",!1,a)},a.prototype.activate=function(a){if(this.get("_enabled"))return this.set("_active",!0,a)},a.prototype.inactivate=function(a){if(this.get("_enabled"))return this.set("_active",!1,a)},a.prototype.isEnabled=function(){return this.get("_enabled")},a.prototype.isActive=function(){return this.get("_enabled")&&this.get("_active")};return a}();return{Model:a}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};define("common/views/state",[],function(){var a;a=function(){function a(){this.disable=__bind(this.disable,this),this.enable=__bind(this.enable,this),this.inactivate=__bind(this.inactivate,this),this.activate=__bind(this.activate,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.initialize=function(){this.model.bind("active",this.activate),this.model.bind("inactive",this.inactivate),this.model.bind("enabled",this.enable);return this.model.bind("disabled",this.disable)},a.prototype.activate=function(){return this.el.addClass("active")},a.prototype.inactivate=function(){return this.el.removeClass("active")},a.prototype.enable=function(){return this.el.show()},a.prototype.disable=function(){return this.el.hide()};return a}();return{View:a}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define("common/views/collection",[],function(){var a;a=function(){function a(){this.destroy=__bind(this.destroy,this),this.remove=__bind(this.remove,this),this.reset=__bind(this.reset,this),this.add=__bind(this.add,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.viewClass=Backbone.View,a.prototype.initialize=function(){this.childViews={},this.collection.bind("add",this.add),this.collection.bind("reset",this.reset),this.collection.bind("remove",this.remove);return this.collection.bind("destroy",this.destroy)},a.prototype.insertChild=function(a){return this.el.append(a.el)},a.prototype.add=function(a){var b,c;(c=a.cid,__indexOf.call(this.childViews,c)>=0)?(b=this.childViews[a.cid],clearTimeout(b._removeTimer)):b=this.childViews[a.cid]=(new this.viewClass({model:a})).render();return this.insertChild(b)},a.prototype.reset=function(a,b){a.each(this.add);if(b.initial)return this.el.animate({opacity:100},500)},a.prototype.remove=function(a){var b;b=this.childViews[a.cid],b.el.detach();return b._removeTimer=setTimeout(__bind(function(){return this.destroy},this),1e4)},a.prototype.destroy=function(a){return this.childViews[a.cid].el.remove()};return a}();return{View:a}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};define("cilantro/define/domain",["common/models/state","common/views/state","common/views/collection"],function(a,b,c){var d,e,f,g,h,i,j,k;d=function(){function b(){b.__super__.constructor.apply(this,arguments)}__extends(b,a.Model);return b}(),e=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection),a.prototype.model=d,a.prototype.url=App.urls.domains,a.prototype.initialize=function(){this.bind("active",this.activate),this.bind("inactive",this.inactivate);return App.hub.subscribe("domain/request",__bind(function(a){var b,c;b=this.get(a);if(b)return b.activate();c=this.subdomains.get(a),b=this.get(c.get("parent").id),b.activate();return c.activate()},this))},a.prototype.parse=function(a,b){var c,d,e,f,g;d=_.groupBy(a,function(a){var b;return((b=a.parent)!=null?b.id:void 0)||null}),this.subdomains=new i,new j({collection:this.subdomains}),c=d["null"],delete d["null"],g=_.flatten(_.values(d));for(f in d)e=parseInt(f),g.push({id:e,name:"All",parent:{id:e}});this.subdomains.reset(g);return c},a.prototype.activate=function(a){App.hub.publish("domain/active",a.id);return this.chain().without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){return App.hub.publish("domain/inactive",a.id)};return a}(),g=function(){function a(){this.click=__bind(this.click,this),a.__super__.constructor.apply(this,arguments)}__extends(a,b.View),a.prototype.el='<span role="domain">\n                <div class="icon"></div><span role="name"></span>\n            </span>',a.prototype.elements={span:"name"},a.prototype.events={click:"click"},a.prototype.render=function(){var a;a=this.model.get("name"),this.el.attr({id:"tab-"+a.toLowerCase()}),this.name.text(this.model.get("name"));return this},a.prototype.click=function(a){return this.model.activate()};return a}(),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,c.View),a.prototype.el="#domains",a.prototype.viewClass=g;return a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,d);return a}(),i=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,e),a.prototype.model=h,a.prototype.initialize=function(){App.hub.subscribe("domain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate);return this.bind("inactive",this.inactivate)},a.prototype.comparator=function(a){return a.id},a.prototype.groupByDomain=function(){return this._byDomain=this.groupBy(function(a){return a.get("parent").id})},a.prototype.toggleEnableByDomain=function(a){var b;b=!1,this.map(__bind(function(c){if(c.get("parent").id!==a)return c.disable();c.enable({reactivate:!0});if(c.isActive())return b=!0},this));if(!b&&this._byDomain[a])return this.get(a).activate()},a.prototype.activate=function(a){App.hub.publish("subdomain/active",a.id);return _(this._byDomain[a.get("parent").id]).without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){return App.hub.publish("subdomain/inactive",a.id)};return a}(),k=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,g),a.prototype.el='<span role="name"></span>',a.prototype.render=function(){this.el.text(this.model.get("name"));return this};return a}(),j=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,f),a.prototype.el="#subdomains",a.prototype.viewClass=k,a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);return App.hub.subscribe("domain/active",this.toggleEnableByDomain)},a.prototype.toggleEnableByDomain=function(a){if(!this.collection._byDomain[a]){if(!this.el.is(":hidden"))return this.el.fadeTo(100,0).slideUp("fast")}else if(this.el.is(":hidden"))return this.el.slideDown("fast").fadeTo(100,1)};return a}();return{Model:d,Collection:e,View:g,CollectionView:f}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define("cilantro/define/concept",["common/models/state","common/views/state","common/views/collection"],function(a,b,c){var d,e,f,g,h;d=function(){function b(){b.__super__.constructor.apply(this,arguments)}__extends(b,a.Model);return b}(),e=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection),a.prototype.model=d,a.prototype.url=App.urls.criteria,a.prototype.initialize=function(){App.hub.subscribe("domain/active",this.toggleEnableByDomain),App.hub.subscribe("subdomain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate),this.bind("inactive",this.inactivate),App.hub.subscribe("concept/request",__bind(function(a){var b;b=this.get(a);if(b){App.hub.publish("domain/request",b.get("domain").id);return b.activate()}},this)),this._activeByDomain={};return this._activeDomain=null},a.prototype.groupByDomain=function(){this._byDomain={},this._bySubdomain={};return this.each(__bind(function(a){var b,c,d,e,f,g,h,i,j,k;b=a.get("domain");if(b.parent){((i=(c=this._bySubdomain)[f=b.id])!=null?i:c[f]=[]).push(a);return((j=(d=this._byDomain)[g=b.parent.id])!=null?j:d[g]=[]).push(a)}return((k=(e=this._byDomain)[h=b.id])!=null?k:e[h]=[]).push(a)},this))},a.prototype.toggleEnableByDomain=function(a){var b,c;this._activeDomain=a,b=this._bySubdomain[a]||this._byDomain[a],this.map(function(a){if(__indexOf.call(b,a)>=0){a.enable();return a.inactivate()}return a.disable()});if(c=this._activeByDomain[a])return c.activate()},a.prototype.activate=function(a){var b;this._activeByDomain[this._activeDomain]=a,b=this._bySubdomain[this._activeDomain]||this._byDomain[this._activeDomain];return _(b).without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){};return a}(),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.el="#concept-description",a.prototype.noDescription='<span class="info">No description available</span>',a.prototype.events={mouseenter:"mouseenter",mouseleave:"mouseleave"},a.prototype.elements={".title":"title",".content":"content"},a.prototype.show=function(a){clearTimeout(this._hoverTimer);return this._hoverTimer=setTimeout(__bind(function(){var b,c,d,e;this.title.text(a.model.get("name")),this.content.html(a.model.get("description")||this.noDescription),b=this.el.outerHeight(),d=a.el.offset(),c=a.el.outerHeight(),e=a.el.outerWidth(),this.el.animate({top:d.top-(b-c)/2,left:d.left+e+5},400,"easeOutQuint");return this.el.fadeIn()},this),200)},a.prototype.hide=function(a){a==null&&(a=!1),clearTimeout(this._hoverTimer);if(a)return this.el.fadeOut();if(!this.entered)return this._hoverTimer=setTimeout(__bind(function(){return this.el.fadeOut()},this),100)},a.prototype.mouseenter=function(a){clearTimeout(this._hoverTimer);return this.entered=!0},a.prototype.mouseleave=function(){clearTimeout(this._hoverTimer),this.entered=!1;return this.hide()};return a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,b.View),a.prototype.template=_.template('<span class="name"><%= name %></span>\n            <span class="description"><%= description %></span>'),a.prototype.events={click:"click"},a.prototype.render=function(){this.el.html(this.template(this.model.toJSON())),this.el.data({cid:this.model.cid});return this},a.prototype.click=function(){return this.model.activate({local:!0})};return a}(),f=function(){function a(){this.activate=__bind(this.activate,this),this.scrollToConcept=__bind(this.scrollToConcept,this),a.__super__.constructor.apply(this,arguments)}__extends(a,c.View),a.prototype.el="#criteria",a.prototype.viewClass=h,a.prototype.events={"mouseenter div":"mouseenter","mouseleave div":"mouseleave","click div":"click"},a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments),this.collection.bind("active",this.activate);return this.description=new g},a.prototype.scrollToConcept=function(a){var b;b=this.childViews[a.cid];return this.el.scrollTo(b.el,{duration:800,axis:"y",offset:{top:this.el.outerHeight()/-2},easing:"easeOutQuint"})},a.prototype.activate=function(a,b){if(b!=null?!b.local:!void 0)return _.defer(this.scrollToConcept,a)},a.prototype.mouseenter=function(a){var b,c;b=$(a.currentTarget).data("cid"),c=this.childViews[b];return this.description.show(c)},a.prototype.mouseleave=function(){return this.description.hide()},a.prototype.click=function(){return this.description.hide(!0)};return a}();return{Model:d,Collection:e,View:h,CollectionView:f}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},__bind=function(a,b){return function(){return a.apply(b,arguments)}};define("cilantro/define/search",["common/views/collection","common/models/state","common/views/state"],function(a,b,c){var d,e,f,g,h;e=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,b.Model);return a}(),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection),a.prototype.model=e,a.prototype.url=App.urls.criteria,a.prototype.query=function(a){return $.get(this.url,{q:a},__bind(function(a){return this.each(function(b){var c;return(c=b.id,__indexOf.call(a,c)>=0)?b.enable():b.disable()})},this))};return a}(),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,c.View),a.prototype.template=_.template('<span class="name"><%= name %></span>\n            <br><span class="info"><%= domain.name %></span>'),a.prototype.events={click:"click"},a.prototype.render=function(){this.el.html(this.template(this.model.toJSON()));return this},a.prototype.click=function(){App.hub.publish("concept/request",this.model.id);return!1};return a}(),h=function(){function b(){this.reposition=__bind(this.reposition,this),b.__super__.constructor.apply(this,arguments)}__extends(b,a.View),b.prototype.el="#concept-search-results",b.prototype.viewClass=g,b.prototype.noResults=$('<div class="info">No results found</div>').hide(),b.prototype.elements={".content":"content"},b.prototype.events={mouseenter:"mouseenter",mouseleave:"mouseleave"},b.prototype.initialize=function(a){this.input||(this.input=new d,this.input.results=this,this.content.append(this.noResults)),this.render();return b.__super__.initialize.apply(this,arguments)},b.prototype.insertChild=function(a){return this.content.append(a.el)},b.prototype.render=function(){this.el.appendTo("body"),this.reposition(),$(window).bind("resize",this.reposition);return this},b.prototype.reposition=function(){var a,b,c,d;d=this.el.outerWidth(),b=this.input.el.offset(),a=this.input.el.outerHeight(),c=this.input.el.outerWidth();return this.el.css({top:b.top+a+5,left:b.left-(d-c)/2})},b.prototype.query=function(a){var b;b=this.collection.query(a);return b.success(__bind(function(a){return a.length?this.noResults.hide():this.noResults.show()},this))},b.prototype.mouseenter=function(){return this.entered=!0},b.prototype.mouseleave=function(){this.entered=!1;if(!this.input.focused)return this.hide()},b.prototype.show=function(){return this.el.fadeIn("fast")},b.prototype.hide=function(){return this.el.fadeOut("fast")};return b}(),d=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.el="#concept-search",a.prototype.elements={":parent":"form"},a.prototype.events={focus:"focus",blur:"blur",keyup:"keyup"},a.prototype.focus=function(){this.focused=!0;if(this.el.val()!=="")return this.results.show()},a.prototype.blur=function(){this.focused=!1;if(!this.results.entered)return this.results.hide()},a.prototype.keyup=function(){this.results.show(),clearTimeout(this._searchTimer);return this._searchTimer=setTimeout(__bind(function(){return this.results.query(this.el.val())},this),200)};return a}();return $(function(){var a,b;a=new f,b=new h({collection:a});return a.fetch()})}),define("cilantro/define/criteria",[],function(){var a=$.jqotec(['<div data-uri="<%=this.uri%>" data-id="<%= this.pk %>" class="criterion clearfix">','<a href="#" class="remove-criterion"></a>','<a href="#" class="field-anchor">',"<%= this.description %>","</a>","</div>"].join("")),b=$("#criteria-list");b.bind("activate-criterion",function(a,c){b.children().removeClass("selected").filter("[data-id="+c+"]").addClass("selected")});var c=function(b,c,d){var e=$($.jqote(a,{pk:b.concept_id,description:d,uri:c+b.concept_id}));e.data("constraint",b),e.find(".remove-criterion").click(function(){e.trigger("CriteriaRemovedEvent");return!1}),e.click(function(a){e.trigger("activate-criterion",[b.concept_id]);return!1});return e};return{Criteria:c}}),define("cilantro/define/criteriamanager",["cilantro/define/criteria"],function(a){var b='<button id="submit-query"><span class="icon arrow-r"/> <span>Get Report</span></button>',c=$("#user-criteria"),d={},e=c.find("#criteria-list"),f=c.find(".content"),g=c.find("#remove-criteria"),h=e.attr("data-uri"),i=e.attr("data-report"),j=c.attr("data-uri"),k=e.children(),l=$(b);$.getJSON(j,function(a){a.store!==null&&!$.isEmptyObject(a.store)&&(a.store.hasOwnProperty("concept_id")?c.triggerHandler("UpdateQueryEvent",[a.store,!0]):$.each(a.store.children.reverse(),function(a,b){c.triggerHandler("UpdateQueryEvent",[b,!0])}))}),l.click(function(){var a=[],b;for(var c in d)d.hasOwnProperty(c)&&a.push(d[c].data("constraint"));a.length<2?b=a[0]:b={type:"and",children:a},$.putJSON(j,JSON.stringify(b),function(){window.location=i})}),g.click(function(){for(var a in d)d.hasOwnProperty(a)&&d[a].trigger("CriteriaRemovedEvent")}),c.bind("UpdateQueryEvent",function(b,g,i){var j=g.concept_id,m;$.isEmptyObject(d)&&(k.detach(),f.append(l)),l.attr("disabled","true"),$.postJSON(h,JSON.stringify(g),function(b){l.removeAttr("disabled");var f=$.isEmptyObject(d);if(d.hasOwnProperty(j))m=a.Criteria(g,h,b),d[j].replaceWith(m),m.fadeTo(300,.5,function(){m.fadeTo("fast",1)});else{m=a.Criteria(g,h,b),i?e.prepend(m):e.append(m);var k=$.Event("ConceptAddedEvent");k.concept_id=j,c.trigger(k)}d[j]=m,i||(m.addClass("selected"),m.siblings().removeClass("selected")),f&&$(e.children()[0]).find(".field-anchor").click()},"text")}),c.bind("CriteriaRemovedEvent",function(a){var b=$(a.target),f=b.data("constraint");d[f.concept_id].remove(),delete d[f.concept_id];var g=$.Event("ConceptDeletedEvent");g.concept_id=f.concept_id,c.trigger(g),$.isEmptyObject(d)&&(e.append(k),l.detach())}),c.bind("ShowConceptEvent",function(a){var b=$(a.target);e.children(".criterion").removeClass("selected");if(b.is(".criterion"))b.addClass("selected");else{var c=a.originalEvent.concept_id;d[c]&&d[c].addClass("selected")}});return{retrieveCriteriaDS:function(a){var b=null;a&&$.each(e.children(),function(c,d){!$(d).data("constraint")||$(d).data("constraint").concept_id==a&&(b=$(d).data("constraint"))});return b}}}),require(["cilantro/modules/report","cilantro/define/domain","cilantro/define/concept","cilantro/define/search","cilantro/define/criteriamanager"],function(a,b,c,d){var e,f;f=new b.Collection,e=new c.Collection,App.pending=2,App.ready(function(){return f.at(0).activate()});return $(function(){App.DomainTabs=new b.CollectionView({collection:f}),App.ConceptList=new c.CollectionView({collection:e}),f.fetch({initial:!0,success:function(){return App.pending--}}),e.fetch({initial:!0,success:function(){return App.pending--}}),App.report=new a.Model,App.ReportName=new a.NameView({model:App.report});return App.report.fetch()})}),define("define/main",function(){})