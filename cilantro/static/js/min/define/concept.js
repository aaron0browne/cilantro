var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define(["common/models/state","common/views/state","common/views/collection"],function(a,b,c){var d,e,f,g,h;d=function(){function b(){b.__super__.constructor.apply(this,arguments)}__extends(b,a.Model);return b}(),e=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.Collection),a.prototype.model=d,a.prototype.url=App.urls.criteria,a.prototype.initialize=function(){App.hub.subscribe("domain/active",this.toggleEnableByDomain),App.hub.subscribe("subdomain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate),this.bind("inactive",this.inactivate),App.hub.subscribe("concept/request",__bind(function(a){var b;b=this.get(a);if(b){App.hub.publish("domain/request",b.get("domain").id);return b.activate()}},this)),this._activeByDomain={};return this._activeDomain=null},a.prototype.groupByDomain=function(){this._byDomain={},this._bySubdomain={};return this.each(__bind(function(a){var b,c,d,e,f,g,h,i,j,k;b=a.get("domain");if(b.parent){((i=(c=this._bySubdomain)[f=b.id])!=null?i:c[f]=[]).push(a);return((j=(d=this._byDomain)[g=b.parent.id])!=null?j:d[g]=[]).push(a)}return((k=(e=this._byDomain)[h=b.id])!=null?k:e[h]=[]).push(a)},this))},a.prototype.toggleEnableByDomain=function(a){var b,c;this._activeDomain=a,b=this._bySubdomain[a]||this._byDomain[a],this.map(function(a){if(__indexOf.call(b,a)>=0){a.enable();return a.inactivate()}return a.disable()});if(c=this._activeByDomain[a])return c.activate()},a.prototype.activate=function(a){var b;this._activeByDomain[this._activeDomain]=a,b=this._bySubdomain[this._activeDomain]||this._byDomain[this._activeDomain];return _(b).without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){};return a}(),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Backbone.View),a.prototype.el="#concept-description",a.prototype.noDescription='<span class="info">No description available</span>',a.prototype.events={mouseenter:"mouseenter",mouseleave:"mouseleave"},a.prototype.elements={".title":"title",".content":"content"},a.prototype.show=function(a){clearTimeout(this._hoverTimer);return this._hoverTimer=setTimeout(__bind(function(){var b,c,d,e;this.title.text(a.model.get("name")),this.content.html(a.model.get("description")||this.noDescription),b=this.el.outerHeight(),d=a.el.offset(),c=a.el.outerHeight(),e=a.el.outerWidth(),this.el.animate({top:d.top-(b-c)/2,left:d.left+e+5},400,"easeOutQuint");return this.el.fadeIn()},this),200)},a.prototype.hide=function(a){a==null&&(a=!1),clearTimeout(this._hoverTimer);if(a)return this.el.fadeOut();if(!this.entered)return this._hoverTimer=setTimeout(__bind(function(){return this.el.fadeOut()},this),100)},a.prototype.mouseenter=function(a){clearTimeout(this._hoverTimer);return this.entered=!0},a.prototype.mouseleave=function(){clearTimeout(this._hoverTimer),this.entered=!1;return this.hide()};return a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,b.View),a.prototype.template=_.template('<span class="name"><%= name %></span>\n            <span class="description"><%= description %></span>'),a.prototype.events={click:"click"},a.prototype.render=function(){this.el.html(this.template(this.model.toJSON())),this.el.data({cid:this.model.cid});return this},a.prototype.click=function(){return this.model.activate({local:!0})};return a}(),f=function(){function a(){this.activate=__bind(this.activate,this),this.scrollToConcept=__bind(this.scrollToConcept,this),a.__super__.constructor.apply(this,arguments)}__extends(a,c.View),a.prototype.el="#criteria",a.prototype.viewClass=h,a.prototype.events={"mouseenter div":"mouseenter","mouseleave div":"mouseleave","click div":"click"},a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments),this.collection.bind("active",this.activate);return this.description=new g},a.prototype.scrollToConcept=function(a){var b;b=this.childViews[a.cid];return this.el.scrollTo(b.el,{duration:800,axis:"y",offset:{top:this.el.outerHeight()/-2},easing:"easeOutQuint"})},a.prototype.activate=function(a,b){if(b!=null?!b.local:!void 0)return _.defer(this.scrollToConcept,a)},a.prototype.mouseenter=function(a){var b,c;b=$(a.currentTarget).data("cid"),c=this.childViews[b];return this.description.show(c)},a.prototype.mouseleave=function(){return this.description.hide()},a.prototype.click=function(){return this.description.hide(!0)};return a}();return{Model:d,Collection:e,View:h,CollectionView:f}})