// Generated by CoffeeScript 1.3.3

define(['environ', 'jquery', 'underscore', 'backbone'], function(environ, $, _, Backbone) {
  var ROUTING;
  ROUTING = false;
  App.routes = {};
  App.loaded = [];
  App.router = new Backbone.Router;
  return App.register = function(route, name, view) {
    var _this = this;
    if (App.routes[name] != null) {
      throw new Error("" + name + " view already registered");
    }
    App.routes[name] = view;
    if (route === false) {
      if (typeof view.load === "function") {
        view.load();
      }
      if (typeof view.resolve === "function") {
        view.resolve();
      }
      return;
    }
    this.router.route(route, name, function() {
      var _base, _base1, _base2, _base3, _i, _len, _name, _ref;
      if (!ROUTING) {
        ROUTING = true;
        _ref = _this.loaded;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          _name = _ref[_i];
          if (typeof (_base = App.routes[_name]).unload === "function") {
            _base.unload();
          }
          if (typeof (_base1 = App.routes[_name]).pending === "function") {
            _base1.pending();
          }
        }
        _this.loaded = [];
        _.defer(function() {
          return ROUTING = false;
        });
      }
      if (typeof (_base2 = App.routes[name]).load === "function") {
        _base2.load();
      }
      if (typeof (_base3 = App.routes[name]).resolve === "function") {
        _base3.resolve();
      }
      return _this.loaded.push(name);
    });
    return this.router.on("route:" + name, function() {
      var links;
      links = $('[data-route]');
      links.parent().removeClass('active');
      return links.filter("[data-route=" + name + "]").parent().addClass('active');
    });
  };
});
