var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["environ","mediator","jquery","underscore","backbone","views/columns","views/table"],function(environ,mediator,$,_,Backbone,Columns,Table){var ReviewArea,modifyColumnsButton;return modifyColumnsButton=_.template('<button class=btn title="Show/Hide Columns"><i class=icon-list alt="Show/Hide Columns"></i></button>'),ReviewArea=function(_super){function ReviewArea(){return this.loadData=__bind(this.loadData,this),ReviewArea.__super__.constructor.apply(this,arguments)}return __extends(ReviewArea,_super),ReviewArea.prototype.id="review-area",ReviewArea.prototype.events={"click table thead th":"sort","click .pinned-thead div":"sort"},ReviewArea.prototype.deferred={loadData:!0},ReviewArea.prototype.initialize=function(){var $modifyColumns,_this=this;return ReviewArea.__super__.initialize.apply(this,arguments),this.$el.hide().appendTo("#main-area .inner"),this.$toolbar=$("<ul>").addClass("nav pull-right").hide().appendTo("#subnav .container-fluid"),this.columns=new Columns({collection:App.DataConcept}),this.columns.$el.appendTo("body"),$modifyColumns=$(modifyColumnsButton()).on("click",function(event){return _this.columns.show()}),this.$toolbar.append($("<li>").html($modifyColumns)),this.table=new Table,this.$el.append(this.table.el),this.table.$el.scroller({relative:"table",trigger:function(){return _this.loadData(!0)}}),mediator.subscribe("dataview/change",this.loadData),mediator.subscribe("datacontext/change",this.loadData),this.page=1,this.loadData()},ReviewArea.prototype.load=function(){this.$el.fadeIn(100),this.$toolbar.fadeIn(100);if(this.tableScrollTop)return this.table.$el.scrollTop(this.tableScrollTop)},ReviewArea.prototype.unload=function(){return this.tableScrollTop=this.table.$el.scrollTop(),this.$el.hide(),this.$toolbar.hide()},ReviewArea.prototype.loadData=function(append){var deferred,url,_this=this;append==null&&(append=!1);if(this.page===(this.num_pages!=null))return;return url="/api/data/",append?url=url+"?page="+(this.page+1):this.table.$el.addClass("loading"),deferred=Backbone.ajax({url:environ.absolutePath(url)}),deferred.done(function(resp){return append?_this.page++:(_this.page=1,_this.num_pages=resp.num_pages,_this.table.setHeader(resp.header)),_this.table.setBody(resp.rows,append)}).always(function(){return _this.table.$el.removeClass("loading"),_this.table.$el.scroller("reset")})},ReviewArea.prototype.sort=function(event){var $target,direction,json,prev;return $target=$(event.target),(prev=$target.data("direction"))?prev==="asc"?direction="desc":direction=null:direction="asc",$target.data("direction",direction),$target.removeClass(prev).addClass(direction),json=App.DataView.session.get("json")||{},direction?json.ordering=[[$target.data("id"),direction]]:json.ordering=[],App.DataView.session.save("json",json)},ReviewArea}(Backbone.View),App.register("review/","review",new ReviewArea)})