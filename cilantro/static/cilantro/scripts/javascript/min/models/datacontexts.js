var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["environ","mediator","underscore","serrano"],function(environ,mediator,_,Serrano){var DataContextHistory,DataContexts;return DataContexts=function(_super){function DataContexts(){return DataContexts.__super__.constructor.apply(this,arguments)}return __extends(DataContexts,_super),DataContexts.prototype.url=environ.absolutePath("/api/contexts/"),DataContexts.prototype.initialize=function(){return this.pending(),this.on("reset",function(){return this.resolve()}),this.fetch()},DataContexts.prototype.getNamed=function(){return this.filter(function(model){return model.get("name")})},DataContexts}(Serrano.DataContexts),DataContextHistory=function(_super){function DataContextHistory(){return DataContextHistory.__super__.constructor.apply(this,arguments)}return __extends(DataContextHistory,_super),DataContextHistory.prototype.url=environ.absolutePath("/api/contexts/history/",{initialize:function(){return this.pending(),this.on("reset",function(){return this.resolve()}),this.fetch()}}),DataContextHistory}(Serrano.DataContexts),App.DataContext=new DataContexts,App.DataContextHistory=new DataContextHistory,App.Models.DataContextNode=Serrano.DataContextNode,App.DataContext.when(function(){var session;return(session=App.DataContext.getSession())||(session=App.DataContext.create({session:!0})),App.DataContext.session=session,session.on("sync",function(){return mediator.publish("datacontext/change")}),session.on("change:json",function(){return session.save(null,{silent:!0})}),mediator.subscribe("datacontext/remove",function(node){return session.remove(node)}),mediator.subscribe("datacontext/add",function(data){return session.isCondition()||session.isComposite()?session.promote(null,data):session.add(null,data)})})})