var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["environ","jquery","underscore","backbone","session"],function(environ,$,_,Backbone,session){var ROUTING,Router;return Router=function(_super){function Router(){return Router.__super__.constructor.apply(this,arguments)}return __extends(Router,_super),Router.prototype.initialize=function(){return $("body").on("click","[data-route]",function(event){return event.preventDefault(),App.router.navigate(this.pathname,{trigger:!0})})},Router}(Backbone.Router),App.router=new Router,App.views={},App.loaded=[],ROUTING=!1,App.register=function(route,name,view){var _this=this;(route=environ.absolutePath(route)).charAt(0)==="/"&&(route=route.substr(1));if(App.views[name]!=null)throw new Error(""+name+" view already registered");App.views[name]=view;if(route===!1){typeof view.load=="function"&&view.load(),typeof view.resolve=="function"&&view.resolve();return}return this.router.route(route,name,function(){var _base,_base1,_base2,_base3,_i,_len,_name,_ref;if(!ROUTING){ROUTING=!0,_ref=_this.loaded;for(_i=0,_len=_ref.length;_i<_len;_i++)_name=_ref[_i],typeof (_base=App.views[_name]).unload=="function"&&_base.unload(),typeof (_base1=App.views[_name]).pending=="function"&&_base1.pending();_this.loaded=[],_.defer(function(){return ROUTING=!1})}return typeof (_base2=App.views[name]).load=="function"&&_base2.load(),typeof (_base3=App.views[name]).resolve=="function"&&_base3.resolve(),_this.loaded.push(name)}),this.router.on("route:"+name,function(){var links;return links=$("[data-route]"),links.parent().removeClass("active"),links.filter("[data-route="+name+"]").parent().addClass("active")})}})