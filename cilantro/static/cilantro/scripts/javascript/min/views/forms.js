var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["environ","jquery","underscore","backbone","templates"],function(environ,$,_,Backbone,Templates){var ControlGroup,FilterControlGroup,FilterForm,MultiEnumControlGroup,NumberControlGroup,SingleEnumControlGroup;return ControlGroup=function(_super){function ControlGroup(){return ControlGroup.__super__.constructor.apply(this,arguments)}return __extends(ControlGroup,_super),ControlGroup.prototype.template=Templates.controlGroup,ControlGroup.prototype.initialize=function(options){return this.setElement(this.template()),this.$label=this.$el.find(".control-label"),this.$controls=this.$el.find(".controls"),this.$helpBlock=this.$el.find(".help-block"),this.hasField=!1},ControlGroup.prototype.addField=function(el){return this.hasField?this.$controls.find("input,select").after(el):(this.$controls.prepend(el),this.hasField=!0)},ControlGroup}(Backbone.View),FilterForm=function(_super){function FilterForm(){return FilterForm.__super__.constructor.apply(this,arguments)}return __extends(FilterForm,_super),FilterForm.prototype.tagName="form",FilterForm.prototype.className="form-inline",FilterForm.prototype.events={submit:"preventDefault","click [name=filter]":"applyFilter","click [name=exclude]":"applyExclude"},FilterForm.prototype.initialize=function(){var group,model,view,_i,_len,_ref;this.fieldsets={},_ref=this.collection.models;for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],model.get("data").enumerable?view=new MultiEnumControlGroup({model:model}):view=new FilterControlGroup({model:model}),group=new ControlGroup,group.addField(view.$el),this.$el.append(group.$el),this.fieldsets[model.id]=view;return this.$controls=$('                <div class=form-controls>                    <button class="btn success" name=filter>Filter</button>                    <button class="btn danger" name=exclude>Exclude</button>                </div>            '),this.$el.append(this.$controls)},FilterForm.prototype.preventDefault=function(event){return event.preventDefault()},FilterForm.prototype.applyFilter=function(){},FilterForm.prototype.applyExclude=function(){},FilterForm}(Backbone.View),FilterControlGroup=function(_super){function FilterControlGroup(){return FilterControlGroup.__super__.constructor.apply(this,arguments)}return __extends(FilterControlGroup,_super),FilterControlGroup.prototype.template=_.template("            <div class=control-group>                <label class=control-label>{{ label }}</label>                <div class=controls>                    <select class=span4 name=operator></select>                    <input class=span4 type={{ type }} name=value>                    <span class=units>{{ units }}</span>                    <p class=help-block>{{ help }}</p>                </div>            </div>        "),FilterControlGroup.prototype.typeMap={"boolean":"checkbox",number:"number",string:"text"},FilterControlGroup.prototype.initialize=function(options){var attrs,_this=this;return attrs=this.model.toJSON(),this.setElement(this.template({label:attrs.name,help:attrs.description,type:this.typeMap[attrs.data.type],units:attrs.data.units})),this.operator=this.$el.find("[name=operator]"),this.value=this.$el.find("[name=value]"),$.each(this.model.get("operators"),function(i,choice){var option;return option=$('<option value="'+choice[0]+'">'+choice[1]+"</option>"),_this.operator.append(option)})},FilterControlGroup.prototype.render=function(filter){if(filter)return this.filter=filter,this.setOperator(),this.setValue()},FilterControlGroup.prototype.getOperator=function(){return this.operator.val()},FilterControlGroup.prototype.getValue=function(){return this.value.val()},FilterControlGroup.prototype.setOperator=function(){return this.operator.val(this.filter.get("operator"))},FilterControlGroup.prototype.setValue=function(){return this.value.val(filter.get("value"))},FilterControlGroup.prototype.applyFilter=function(){return this.filter.set({value:this.getValue(),operator:this.getOperator(),negate:!1})},FilterControlGroup.prototype.applyExclude=function(){return this.filter.set({value:this.getValue(),operator:this.getOperator(),negate:!0})},FilterControlGroup}(Backbone.View),NumberControlGroup=function(_super){function NumberControlGroup(){return NumberControlGroup.__super__.constructor.apply(this,arguments)}return __extends(NumberControlGroup,_super),NumberControlGroup.prototype.events={"change [name=operator]":"toggleOperator"},NumberControlGroup.prototype.initialize=function(){return NumberControlGroup.__super__.initialize.apply(this,arguments),this.value2=this.$el.find("[name=value2]").hide()},NumberControlGroup.prototype.getValue=function(){return/range/.test(this.getOperator())?[this.value.val(),this.value2.val()]:this.value.val()},NumberControlGroup.prototype.setValue=function(){var value;return value=this.filter.get("value"),/range/.test(this.filter.get("operator"))?(this.value.val(value[0]),this.value2.val(value[1])):this.value.val(value)},NumberControlGroup.prototype.toggleOperator=function(){return/range/.test(this.getOperator())?this.value2.show():this.value2.hide()},NumberControlGroup}(FilterControlGroup),SingleEnumControlGroup=function(_super){function SingleEnumControlGroup(){return SingleEnumControlGroup.__super__.constructor.apply(this,arguments)}return __extends(SingleEnumControlGroup,_super),SingleEnumControlGroup.prototype.initialize=function(options){var _this=this;return SingleEnumControlGroup.__super__.initialize.apply(this,arguments),$.each(this.model.get("data").choices,function(i,choice){var option;return option=$('<option value="'+choice[0]+'">'+choice[1]+"</option>"),_this.value.append(option)})},SingleEnumControlGroup.prototype.getOperator=function(){return"in"},SingleEnumControlGroup}(FilterControlGroup),MultiEnumControlGroup=function(_super){function MultiEnumControlGroup(){return MultiEnumControlGroup.__super__.constructor.apply(this,arguments)}return __extends(MultiEnumControlGroup,_super),MultiEnumControlGroup.prototype.template=_.template("            <select name=value multiple></select>        "),MultiEnumControlGroup}(SingleEnumControlGroup),{FilterForm:FilterForm,FilterControlGroup:FilterControlGroup,NumberControlGroup:NumberControlGroup,SingleEnumControlGroup:SingleEnumControlGroup,MultiEnumControlGroup:MultiEnumControlGroup}})