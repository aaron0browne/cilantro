var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["environ","mediator","jquery","underscore","backbone"],function(environ,mediator,$,_,Backbone){var Columns;return Columns=function(_super){function Columns(){return this.remove=__bind(this.remove,this),this.add=__bind(this.add,this),this.render=__bind(this.render,this),Columns.__super__.constructor.apply(this,arguments)}return __extends(Columns,_super),Columns.prototype.template=_.template('            <div id=columns-modal class="modal fade">                <div class=modal-header>                    <a class=close data-dismiss=modal>Ã—</a>                    <h3>Data Columns</h3>                </div>                <div class=modal-body>                    <ul class="available-columns span5"></ul>                    <ul class="selected-columns span5"></ul>                </div>                <div class=modal-footer>                    <button data-save class="btn btn-primary">Save</button>                    <button data-close class=btn>Close</button>                </div>            </div>        '),Columns.prototype.availableItemTemplate=_.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-success btn-mini">+</button>                </span>            </li>        '),Columns.prototype.selectedItemTemplate=_.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-danger btn-mini">-</button>                </span>            </li>        '),Columns.prototype.events={"click [data-close]":"hide","click [data-save]":"save","click .available-columns button":"clickAdd","click .selected-columns button":"clickRemove"},Columns.prototype.initialize=function(){var _this=this;return this.setElement(this.template()),this.$available=this.$(".available-columns"),this.$selected=this.$(".selected-columns").sortable({cursor:"move",forcePlaceholderSize:!0,placeholder:"placeholder"}),this.$el.addClass("loading"),this.collection.when(function(){return _this.$el.removeClass("loading"),_this.render()}),$.when(App.DataView,this.collection,function(){var id,json,_i,_len,_ref;if(json=App.DataView.session.get("json")){_ref=json.concepts;for(_i=0,_len=_ref.length;_i<_len;_i++)id=_ref[_i],_this.add(id)}})},Columns.prototype.render=function(){var availableHtml,model,selectedHtml,_i,_len,_ref;availableHtml=[],selectedHtml=[],_ref=this.collection.filter(function(model){return model.get("formatter")});for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],availableHtml.push(this.availableItemTemplate(model.attributes)),selectedHtml.push(this.selectedItemTemplate(model.attributes));return this.$available.html(availableHtml.join("")),this.$selected.html(selectedHtml.join("")),this},Columns.prototype.showAvailableControls=function(event){return clearTimeout(this._availableControlsTimer),this.$available.find(".controls").fadeIn(100)},Columns.prototype.hideAvailableControls=function(event){var _this=this;return clearTimeout(this._availableControlsTimer),this._availableControlsTimer=_.delay(function(){return _this.$available.find(".controls").fadeOut(100)},300)},Columns.prototype.showSelectedControls=function(event){return clearTimeout(this._selectedControlsTimer),this.$selected.find(".controls").fadeIn(100)},Columns.prototype.hideSelectedControls=function(event){var _this=this;return clearTimeout(this._selectedControlsTimer),this._selectedControlsTimer=_.delay(function(){return _this.$selected.find(".controls").fadeOut(100)},300)},Columns.prototype.show=function(){return this.$el.modal("show")},Columns.prototype.hide=function(){return this.$el.modal("hide")},Columns.prototype.save=function(){var ids,json;return this.hide(),ids=$.map(this.$selected.children(),function(elem){var data;if((data=$(elem).data()).selected)return data.id}),json=App.DataView.session.get("json")||{},json.concepts=ids,App.DataView.session.save("json",json)},Columns.prototype.add=function(id){return this.$available.find("[data-id="+id+"]").closest("li").hide(),this.$selected.find("[data-id="+id+"]").detach().appendTo(this.$selected).show().data("selected",!0)},Columns.prototype.remove=function(id){return this.$selected.find("[data-id="+id+"]").hide().data("selected",!1),this.$available.find("[data-id="+id+"]").closest("li").show()},Columns.prototype.clickAdd=function(event){return event.preventDefault(),this.add($(event.target).closest("li").data("id"))},Columns.prototype.clickRemove=function(event){return event.preventDefault(),this.remove($(event.target).closest("li").data("id"))},Columns}(Backbone.View)})