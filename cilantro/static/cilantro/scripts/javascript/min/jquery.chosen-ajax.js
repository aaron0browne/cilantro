(function($){return $.fn.ajaxChosen=function(settings,callback){var chosenXhr,defaultOptions,options,select;return settings==null&&(settings={}),callback==null&&(callback=function(){}),defaultOptions={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term"},select=this,chosenXhr=null,options=$.extend({},defaultOptions,settings),this.chosen(),this.each(function(){return $(this).next(".chzn-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var field,msg,success,val;return val=$.trim($(this).attr("value")),msg=val.length<options.minTermLength?"Keep typing...":"Looking for '"+val+"'",select.next(".chzn-container").find(".no-results").text(msg),val===$(this).data("prevVal")?!1:($(this).data("prevVal",val),this.timer&&clearTimeout(this.timer),val.length<options.minTermLength?!1:(field=$(this),options.data==null&&(options.data={}),options.data[options.jsonTermKey]=val,success=options.success,options.success=function(data){var items,selected_values;if(data==null)return;return selected_values=[],select.find("option").each(function(){return $(this).is(":selected")?selected_values.push($(this).val()+"-"+$(this).text()):$(this).remove()}),items=callback(data),$.each(items,function(value,text){if($.inArray(value+"-"+text,selected_values)===-1)return $("<option />").attr("value",value).html(text).appendTo(select)}),select.trigger("liszt:updated"),success!=null&&success(data),field.attr("value",val),field.css("width","auto")},this.timer=setTimeout(function(){return chosenXhr&&chosenXhr.abort(),chosenXhr=$.ajax(options)},options.afterTypeDelay)))})})}})(jQuery)