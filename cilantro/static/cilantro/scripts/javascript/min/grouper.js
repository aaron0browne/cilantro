(function(root,factory){return typeof define=="function"&&define.amd?define(["underscore"],factory):root.grouper=factory(root._)})(this,function(_){var renderTable,sortedGroupBy;return sortedGroupBy=function(list,groupBy,sortBy){var groupByIter,groups,sortByIter;return _.isArray(groupBy)?groupByIter=function(obj){return _.map(groupBy,function(key,value){return obj[key]})}:groupByIter=groupBy,_.isArray(sortBy)?sortByIter=function(obj){return _.map(sortBy,function(key,value){return obj[key]})}:sortByIter=sortBy,groups=_.groupBy(list,groupByIter),sortByIter&&_.each(groups,function(value,key,list){return list[key]=_.sortBy(value,sortByIter)}),groups},renderTable=function(groups,keys,sep){var html;return html=[],sep=sep||",",_.each(groups,function(list,groupKey){var group,header,label,table,tbody;return group=$("<div>").addClass("group"),label=$("<span>").addClass("group-label"),table=$("<table>").addClass("group-table"),header=$("<tr>"),tbody=$("<tbody>"),_.isString(groupKey)?_.each(groupKey.split(sep),function(tok){return label.append("<span class=group-key>"+$.trim(tok)+"</span>")}):label.append("<span class=group-key>"+groupKey+"</span>"),_.each(list,function(obj,i){var tr;return tr=$("<tr>"),_.each(obj,function(value,key){return keys.indexOf(key)>=0?i===0:(i===0&&header.append("<th>"+key+"</th>"),tr.append("<td>"+value+"</td>"))}),tbody.append(tr)}),$("<thead>").appendTo(table).append(header),table.append(tbody),group.append(label,table),html.push(group)}),html},{sortedGroupBy:sortedGroupBy,renderTable:renderTable}})